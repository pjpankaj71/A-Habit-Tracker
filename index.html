<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Check-In</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root {
    --yellow: #ffd600;
    --black: #000000;
    --bg-light: #ffffff;
    --bg-dark: #1c1c1c;
    --text-light: #000000;
    --text-dark: #ffffff;
  }
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom, #fff, #fff7e0);
    color: var(--black);
  }
  .container {
    max-width: 800px;
    margin: auto;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .logo-icon {
    background: var(--yellow);
    color: var(--black);
    font-weight: bold;
    padding: 0.5rem 0.8rem;
    border-radius: 8px;
  }
  .card {
    background: var(--bg-light);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }
  .btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
  }
  .btn-yellow {
    background: var(--yellow);
    color: var(--black);
    font-weight: bold;
  }
  .btn-clear {
    background: #fff;
    color: var(--black);
    border: 1px solid #ccc;
  }
  .habit-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .habit-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border-radius: 8px;
    background: #f9f9f9;
  }
  .weekly-overview {
    display: flex;
    overflow-x: auto;
    gap: 0.5rem;
    padding-bottom: 0.5rem;
  }
  .week-day {
    min-width: 60px;
    text-align: center;
  }
  input {
    width: 100%;
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
  .emoji-picker {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  .emoji-btn {
    font-size: 1.5rem;
    cursor: pointer;
    background: transparent;
    border: none;
  }
  @media (min-width: 600px) {
    .container {
      flex-direction: row;
    }
    .habit-section, .add-section {
      flex: 1 1 50%;
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="habit-section card">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">DC</div>
        <div>
          <h2>Daily Check-In</h2>
          <small>Sleek habit tracker ‚Äî built for Telegram.</small>
        </div>
      </div>
      <div>
        <button class="btn btn-yellow" onclick="showAddForm()">+ Add Habit</button>
        <button class="btn btn-clear" onclick="clearData()">Clear data</button>
      </div>
    </div>
    <div id="habitList" class="habit-list"></div>
  </div>
  
  <div class="add-section card">
    <h3>Add / Edit Habit</h3>
    <input type="text" id="habitName" placeholder="Habit name (e.g., 'Read 20 min')">
    <div class="emoji-picker">
      <button class="emoji-btn" onclick="selectIcon('üíß')">üíß</button>
      <button class="emoji-btn" onclick="selectIcon('üèÉ')">üèÉ</button>
      <button class="emoji-btn" onclick="selectIcon('üíª')">üíª</button>
      <button class="emoji-btn" onclick="selectIcon('üìö')">üìö</button>
      <button class="emoji-btn" onclick="selectIcon('üõè')">üõè</button>
    </div>
    <button class="btn btn-yellow" style="margin-top:0.5rem;" onclick="saveHabit()">Save</button>
    <h3>Weekly Overview</h3>
    <div id="weeklyOverview" class="weekly-overview"></div>
  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();
  const userId = tg.initDataUnsafe?.user?.id || "demo-user";
  let selectedIcon = '';
  let data = JSON.parse(localStorage.getItem('habitsData') || '{}');
  if (!data[userId]) data[userId] = { habits: [] };

  function renderHabits() {
    const list = document.getElementById('habitList');
    list.innerHTML = '';
    if (data[userId].habits.length === 0) {
      list.innerHTML = '<p>No habits yet ‚Äî add one using the button above.</p>';
      return;
    }
    data[userId].habits.forEach(habit => {
      const item = document.createElement('div');
      item.className = 'habit-item';
      item.innerHTML = `<span>${habit.icon} ${habit.name}</span>
                        <button class="btn btn-yellow" onclick="checkIn('${habit.id}')">Check In</button>`;
      list.appendChild(item);
    });
  }
  function renderWeeklyOverview() {
    const overview = document.getElementById('weeklyOverview');
    overview.innerHTML = '';
    const today = new Date();
    for (let i = 6; i >= 0; i--) {
      const d = new Date(today);
      d.setDate(today.getDate() - i);
      overview.innerHTML += `<div class="week-day">
        <div>${d.toLocaleDateString('en-US', { weekday: 'short' })}</div>
        <small>${d.toISOString().slice(0,10)}</small>
      </div>`;
    }
  }
  function selectIcon(icon) { selectedIcon = icon; }
  function saveHabit() {
    const name = document.getElementById('habitName').value.trim();
    if (!name || !selectedIcon) return alert('Please enter name & select icon');
    data[userId].habits.push({ id: Date.now().toString(), name, icon: selectedIcon, completions: [] });
    localStorage.setItem('habitsData', JSON.stringify(data));
    document.getElementById('habitName').value = '';
    selectedIcon = '';
    renderHabits();
  }
  function checkIn(id) {
    const habit = data[userId].habits.find(h => h.id === id);
    const today = new Date().toISOString().slice(0,10);
    if (!habit.completions.includes(today)) {
      habit.completions.push(today);
      tg.HapticFeedback?.impactOccurred('light');
      alert('Great job! üéâ');
    }
    localStorage.setItem('habitsData', JSON.stringify(data));
  }
  function clearData() {
    if (confirm('Clear all data?')) {
      data[userId] = { habits: [] };
      localStorage.setItem('habitsData', JSON.stringify(data));
      renderHabits();
    }
  }
  renderHabits();
  renderWeeklyOverview();
</script>
</body>
</html>
